parameters:
  - name: actionGroups
    type: object
    default: []
  - name: enableProduction
    type: boolean
    default: false
  - name: runReviewStage
    type: boolean
    default: false
  - name: drInvocation
    type: boolean
    default: false
  - name: skipEnvironments
    type: object
    default:
      dev: false
      qa: true
      ppr: true
  - name: skipRegions
    type: object
    default:
      primary: false
      secondary: true
  - name: globalDependsOn
    type: string
    default: validation
  - name: pipelineType
    type: string
    default: auto

resources:
  repositories:
    - repository: PipelineDispatcher
      type: github
      endpoint: wesley-trust
      name: wesley-trust/pipeline-dispatcher
      ref: "refs/heads/main"

extends:
  template: /templates/pipeline-configuration-dispatcher.yml@PipelineDispatcher
  parameters:
    skipEnvironments: ${{ parameters.skipEnvironments }}
    skipRegions: ${{ parameters.skipRegions }}
    globalDependsOn: ${{ parameters.globalDependsOn }}
    configuration:
      actionGroups: ${{ parameters.actionGroups }}
      enableProduction: ${{ parameters.enableProduction }}
      runReviewStage: ${{ parameters.runReviewStage }}
      drInvocation: ${{ parameters.drInvocation }}

      # Configuration Override
      pipelineType: ${{ parameters.pipelineType }}
      # variables:
      #   includeCommon: true
      #   includeEnv: true
      #   includeEnvRegion: true
      #   includeRegion: true

    # Environments Override
    # environments:
    #   - name: dev
    #     class: development
    #     dependsOnSecondaryRegions: false
    #     primaryRegion: weu
    #     secondaryRegions:
    #       - neu
    #     drRegion: neu
    #     allowedBranches:
    #       - "*"
    #     pool:
    #       vmImage: "ubuntu-latest"
    #     poolRegionDemand: false